## 命令管理与执行详解

命令管理器(`CommandManager`)扮演着智能衣柜系统中极为关键的角色，它负责解析用户输入的命令并据此执行对应的动作，以实现设备控制等功能。该管理器涵盖了从灯光控制到摄像头操作的多种设备控制命令。

### 命令格式规范

命令遵循一定的格式规范`<操作对象>  (<操作对象> ...) -<命令> [-<参数>]`，例如，`act light -on`告知执行器模块的灯光打开。

### 详细命令列表与解释

命令详解如下，分为执行器和传感器两大类，以覆盖系统的各项功能需求。





### 执行器类命令：

基础命令`act`是用于指示智能衣柜执行特定动作的关键词，如操控灯光或激活除湿器等。

#### 灯光控制（执行元件 `-light`）

- **打开灯光命令：`act light -on`**
    - **作用**：此命令通过将灯光亮度设置为最大值（通常认为是100%）来打开灯光，确保衣柜内部光线充足。
    - **实现细节**：`Light::getInstance()->setLightIntensity(100);`调用`Light`类的单例实例，使用`setLightIntensity`
      方法并传入参数`100`来实现灯光调至最亮。

- **关闭灯光命令：`act light -off`**
    - **作用**：该命令通过将灯光亮度设置为最低值来关闭灯光，以节约能源或在不需要时关闭灯光。
    - **实现细节**：`Light::getInstance()->setLightIntensity(0);`同样调用`Light`类的单例实例，并传入参数`0`
      至`setLightIntensity`方法以关闭灯光。

- **自动调节灯光：`act light -auto`**
  - **作用**：该命令通过传感器检测环境亮度，自动调节灯光亮度，以保持衣柜内部的适宜亮度。
  - **实现细节**：

- **手动调节灯光：`act light -manuel`**
  - **作用**：通过 APP，用户手动控制灯光的开关。
  - **实现细节**：

- **手动设置亮度值：`act light -v 72` **
  - **作用**：该命令通过手动设置灯光亮度值来调节灯光亮度，允许用户根据实际需求调整灯光亮度。
  - **实现细节**：

#### 摄像头控制（执行原件 `cam`）

- **拍照命令：`sens cam -shot`**
    - **作用**：触发OV7670 FIFO摄像头模块进行一次拍照，用于捕获并存储当前衣柜内部的图像，方便用户远程查看。
    - **实现细节**：`Camera::getInstance()->captureImage();`通过调用`Camera`
      类的单例实例来执行拍照动作。但是拍摄的照片存储在AL422芯片中，此命令通过串口打印图片数据，或者立刻传回数据。

- **上传图像命令：`sens cam -upload`** （待实现）
    - **作用**：将OV7670 FIFO摄像头模块最近一次拍摄的图像上传至指定服务器或云平台，允许用户远程访问和查看衣柜内部的情况。
    - **实现细节**：该动作需要结合网络通信模块实现图像数据的发送，具体实现取决于所选云平台的API和网络协议要求。


#### 加湿器控制（执行原件 `humidify`）

- **加湿：`act humidify -on`**
  - **作用**：湿度控制器开始喷雾增加湿度。如果湿度控制器已经开始喷雾了，此命令无效。
  - **实现细节**：

- **停止加湿：`act humidify -off`**
  - **作用**：湿度控制器停止喷雾。如果湿度控制器当前没有喷雾，此命令无效。
  - **实现细节**：

#### 干燥器控制（执行原件 `dehumidify`）

- **立刻烘干：`act dehumidify -on`**
  - **作用**：湿度控制器电机开始转动，将空气送入干燥剂制成的空气通道，然后再返送到衣柜中，主要利用除湿风扇原件降低湿度。如果干燥控制器已经开始工作了，此命令无效。
  - **实现细节**：dehumidify

- **结束烘干：`act dehumidify -off`**
  - **作用**：湿度控制器停止干燥。风扇停止转动，将空气送入干燥器的通道关闭。如果干燥器没有工作，则此命令无效。
  - **实现细节**：


#### 降温控制（执行原件 `cool`）

- **立刻降温：`act cool -on`**
  - **作用**：降温风扇开启。如果原件已经开始工作了，此命令无效。
  - **实现细节**：

- **关闭降温：`act cool -off`**
  - **作用**：降温风扇关闭，风扇停止转动。如果元件没有工作，则此命令无效。
  - **实现细节**：

#### 加热控制（执行原件 `heat`）

- **立刻加热：`act heat -on`**
  - **作用**：打开加热片进行加热，如果加热控制器已经开始工作了，此命令无效。
  - **实现细节**：dehumidify

- **关闭加热：`act heat -off`**
  - **作用**：关闭加热片，如果加热控制器正处在关闭状态，此命令无效。
  - **实现细节**：

#### 衣架（执行原件 `shelf`）

- **舵机角度设定（仅仅测试用）：`act shelf -servo_angle 45`**
  - **作用**：设定舵机转到规定的角度（这里是45度）。此函数的参数可以为负值，但必须位于-360度到+360度之间。
  - **实现细节**：

**皮带旋转到特定角度（仅仅测试用）：`act shelf -stepper_step 4096`**

- **作用**：将皮带和舵机（模拟机械臂）旋转4096步（参数任意），4096步代表一圈。此函数的参数可以为负值。
- **实现细节**：

**皮带旋转测试（仅仅测试用）：`act shelf -stepper_run`**

- **作用**：简单暴力让皮带转动
- **实现细节**：








#### 网络（执行原件 `net`）

- **上传原始数据：`net -uploadRaw "data"`**
  - **作用**：向云平台直接上传数据。数据不经过打包，直接上传。注意:data 那个字符串必须要有双引号。否则无法解析正确
  - **实现细节**：

- **Ping命令：`net -ping`**
  - **作用**：检查网络连接和服务器数据处理是否正常。
  - **实现细节**：

- **上传温湿度数据命令：`net -dht`**
  - **作用**：立刻上传当前温湿度数据到服务器。
  
  - **实现细节**：
  
- **上传光照数据命令：`net -light`**
  - **作用**：立刻上传当前温湿度数据到服务器。
  
  - **实现细节**：
  





### 命令架构图

以下是命令层级树的ASCII画图表示：

```
CommandManager
|
|-- act
|   |-- light
|   |   |-- -on
|   |   |-- -off
|   |   |-- -auto
|   |   |-- -v <int>
|
|-- sens
|   |-- cam
|       |-- -shot
|       |-- -upload
|
|-- net
|   |-- -tx
|   |-- -uploadRaw "data"
|   |-- -ping
|   |-- -dht
|   |-- -light
```

这个ASCII树结构清晰地展示了智能衣柜系统中的命令层级关系。`CommandManager`作为顶层管理器，下分为`act`（执行器类命令）、`sens`
（传感器控制命令）和`net`（网络数据传输命令）三大主命令类别。每个主类别下又细分为具体的设备或操作对象，如`light`和`cam`
，以及它们对应的操作命令，例如`-on`、`-off`、`-shot`和`-upload`。特别地，`net -tx -raw "data"`命令直接传输原始数据至云平台。

这种结构化的命令设计，旨在提供清晰的操作逻辑和高效的命令执行路径，以便用户可以直观地与系统进行交互。

通过上述命令管理与执行的详细解释，用户能够明确每个命令的具体作用及其背后的实现逻辑，从而更高效地与智能衣柜系统进行交互。